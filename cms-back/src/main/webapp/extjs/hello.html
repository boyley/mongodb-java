<html>
<head>
    <title>extjs-demo--来自www.jarorwar.com的教程</title>
    <link rel="stylesheet" type="text/css" href="resources/css/ext-all.css"/>
    <script type="text/javascript" src="bootstrap.js"></script>
    <script type="text/javascript">
        Ext.Loader.setConfig({enabled: true});
        Ext.require([
            'Ext.form.*',
            'Ext.grid.*',
            'Ext.data.*',
            'Ext.util.*',
            'Ext.toolbar.Paging',
            'Ext.ModelManager',
            'Ext.tip.QuickTipManager'

        ]);
        Ext.onReady(function() {

            Ext.apply(Ext.form.VTypes, {
                daterange: function(val, field) {
                    var date = field.parseDate(val);
                    var dispUpd = function(picker) {
                        var ad = picker.activeDate;
                        picker.activeDate = null;
                        picker.update(ad);
                    };
                    if (field.startDateField) {
                        var sd = Ext.getCmp(field.startDateField);
                        sd.maxValue = date;
                        if (sd.menu && sd.menu.picker) {
                            sd.menu.picker.maxDate = date;
                            dispUpd(sd.menu.picker);
                        }
                    } else if (field.endDateField) {
                        var ed = Ext.getCmp(field.endDateField);
                        ed.minValue = date;
                        if (ed.menu && ed.menu.picker) {
                            ed.menu.picker.minDate = date;
                            dispUpd(ed.menu.picker);
                        }
                    }
                    return true;
                }
            });
            Ext.define("User", {
                extend:'Ext.data.Model',
                fields: [
                    'sid','userName','email','handPhone',
                    {'name':'age','type':'int'}
                ]
            });
            var store = Ext.create('Ext.data.Store', {
                pageSize: 10,
                model: 'User',
                id:'user_store',
                baseParams
                //remoteSort: true,
                proxy: {
                    type: 'ajax',
                    url: '/l.jsp',
                    reader: {
                        type: 'json',
                        root: 'users',
                        totalProperty: 'totalCount'
                    }//,
                    // sends single sort as multi parameter
                    //simpleSortMode: true
                }/*,
                 sorters: [{
                 property: 'lastpost',
                 direction: 'DESC'
                 }]*/
            });


            var grid = Ext.create('Ext.grid.Panel', {
                width: 700,
                height: 200,
                title: 'http://www.jarorwar.com',
                store: store,
                disableSelection: true,
                loadMask: true,
                viewConfig: {
                    id: 'gv',
                    trackOver: false,
                    stripeRows: false/*,
                     plugins: [{
                     ptype: 'preview',
                     bodyField: 'excerpt',
                     expanded: true,
                     pluginId: 'preview'
                     }]*/
                },
                // grid columns
                columns:[
                    {
                        // id assigned so we can apply custom css (e.g. .x-grid-cell-topic b { color:#333 })
                        // TODO: This poses an issue in subclasses of Grid now because Headers are now Components
                        // therefore the id will be registered in the ComponentManager and conflict. Need a way to
                        // add additional CSS classes to the rendered cells.
                        id: 'sid',
                        text: "序号",
                        dataIndex: 'sid',
                        // flex: 1,
                        width:20,
                        // renderer: renderTopic,
                        sortable: true
                    },
                    {
                        text: "姓名",
                        dataIndex: 'userName',
                        width: 100,
                        hidden: false,
                        sortable: false
                    },
                    {
                        text: "电子邮件",
                        dataIndex: 'email',
                        width: 70,
                        align: 'right',
                        sortable: true
                    },
                    {
                        //id: 'last',
                        text: "手机号码",
                        dataIndex: 'handPhone',
                        width: 150,
                        // renderer: renderLast,
                        sortable: false
                    },
                    {
                        text:"年龄",
                        dataIndex:"age",
                        sortable:true,
                        width:50
                    }
                ],
                tbar:Ext.create('Ext.toolbar.Toolbar', {
                    items: [
                        {
                            id:'startdt',
                            xtype: 'datefield',
                            anchor: '100%',
                            fieldLabel: '开始时间',
                            name: 'from_date',
                            maxValue: new Date(),
                            endDateField: 'enddt',
                            format: 'Y-m-d',
                            vtype: 'daterange'
                        },
                        {
                            id:'enddt',
                            xtype: 'datefield',
                            anchor: '100%',
                            fieldLabel: '结束时间',
                            name: 'to_date',
                            maxValue: new Date(),
                            format: 'Y-m-d',
                            startDateField: 'startdt',
                            vtype: 'daterange'
                        },{
                            id:'sbt',
                            xtype:'button',
                            text:'查询',
//                            enableToggle: true,
                            pressed:true ,
                            handler: searchByTime
                        }
                    ]
                }),
                // paging bar on the bottom
                bbar: Ext.create('Ext.PagingToolbar', {
                    store: store,
                    id:'myptb',
                    displayInfo: true,
                    displayMsg:'第{0}条到{1}条记录,一共{2}条',
                    emptyMsg:'没有记录',
                    afterPageText: "页,共{0}页",
                    beforePageText: "当前是第"   ,
                    items:[
                        '-', {
                            text: '刷新',
                            // pressed: pluginExpanded,
                            enableToggle: true,
                            toggleHandler: function(btn, pressed) {
                                alert(Ext.getCmp('myptb').getPageData().pages
                                );
                            }
                        }]
                }),
                renderTo: 'topic-grid'
            });
            store.loadPage(1);
        });

         function searchByTime(btn){
             var start=Ext.util.Format.date(Ext.getCmp('startdt').getValue(), 'Y-m-d')+" 00:00:00";
             var end=Ext.util.Format.date(Ext.getCmp('enddt').getValue(), 'Y-m-d')+" 23:59:59";
             var store = Ext.getCmp('user_store');
             store.baseParams({'startTime':start,'endTime':end});
             store.loadPage(1);

//                alert(start+"-->"+end);
            }
    </script>
</head>
<body>
<div id="topic-grid"></div>
</body>
</html>